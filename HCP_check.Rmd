---
title: "HCP_check"
author: "GShearrer"
date: "9/17/2020"
output: html_document
---

This document is to double check the results from the HCP_graph document
```{r, echo=FALSE}
library(tidyverse)
library(magrittr)
library(purrr)
library(plyr)
library(ggplot2)
library(data.table)
library(dplyr)
# library(formattable)
library(gplots)
library(lm.beta)
library(mgcv)
library(lsmeans)
library(psych)
library(multcomp)
library(gridExtra)
library(grid)
library(nlme)
```

# Functions
```{r, echo=FALSE}
cbPalette <- c( "#E69F00", "#56B4E9",  "#CC79A7")
violin <- function(d, x, y){
  plot1<-ggplot(d, aes(factor(x), y)) + 
    geom_violin(aes(fill = x),stat = "ydensity",draw_quantiles = c(0.25, 0.5, 0.75))+scale_fill_manual(values=cbPalette)+theme_classic()
  return(plot1)
}
```


```{r}
dat_check <-read.table("~/Google Drive/HCP/HCP_graph/1200/datasets/tmp/complete_data.csv", sep=",", header=T)
head(dat_check)
dat_check$subject <- as.factor(dat_check$subject)
dat_check$Subject<-dat_check$subject
colnames(dat_check)
```


#  Loading in the data
## Demographics
```{r, echo=FALSE}
dat_check$Age_c<-scale(dat_check$Age_in_Yrs, scale = FALSE)
dat_check$HBA1c_c<-scale(dat_check$HbA1C, scale = FALSE)
dat_check$group <- ordered(dat_check$group, levels = c("no", "ov", "ob"))

dat_check$race_eth[dat_check$Race == "White" & dat_check$Ethnicity == "Hispanic/Latino" ] <- "White and Hispanic"
dat_check$race_eth[dat_check$Race == "Black or African Am." & dat_check$Ethnicity =="Hispanic/Latino" ] <- "Black or African American and Hispanic"
dat_check$race_eth[dat_check$Race == "Am. Indian/Alaskan Nat." & dat_check$Ethnicity =="Hispanic/Latino" ] <- "Native American and Hispanic"
dat_check$race_eth[dat_check$Race == "Asian/Nat. Hawaiian/Othr Pacific Is." & dat_check$Ethnicity =="Hispanic/Latino" ] <- "Asian and Hispanic"
dat_check$race_eth[dat_check$Race == "More than one" & dat_check$Ethnicity =="Hispanic/Latino" ] <- "Multi-racial and Hispanic"
dat_check$race_eth[dat_check$Race == "Unknown or Not Reported" & dat_check$Ethnicity =="Hispanic/Latino" ] <- "Unknown or not reported and Hispanic"

dat_check$race_eth[dat_check$Race == "White" &dat_check$Ethnicity == "Not Hispanic/Latino"] <- "White"
dat_check$race_eth[dat_check$Race == "Black or African Am." & dat_check$Ethnicity =="Not Hispanic/Latino" ] <- "Black or African American"
dat_check$race_eth[dat_check$Race == "Am. Indian/Alaskan Nat." & dat_check$Ethnicity =="Not Hispanic/Latino" ] <- "Native American"
dat_check$race_eth[dat_check$Race == "Asian/Nat. Hawaiian/Othr Pacific Is." & dat_check$Ethnicity == "Not Hispanic/Latino"] <- "Asian"
dat_check$race_eth[dat_check$Race == "More than one" & dat_check$Ethnicity =="Not Hispanic/Latino" ] <- "Multi-racial"
dat_check$race_eth[dat_check$Race == "Unknown or Not Reported" & dat_check$Ethnicity =="Not Hispanic/Latino" ] <- "Unknown or not reported"

dat_check$race_eth[dat_check$Race == "White" & dat_check$Ethnicity =="Unknown or Not Reported"] <- "White"
dat_check$race_eth[dat_check$Race == "Black or African Am." & dat_check$Ethnicity =="Unknown or Not Reported"] <- "Black or African American"
dat_check$race_eth[dat_check$Race == "Am. Indian/Alaskan Nat." & dat_check$Ethnicity =="Unknown or Not Reported" ] <- "Native American"
dat_check$race_eth[dat_check$Race == "Asian/Nat. Hawaiian/Othr Pacific Is." & dat_check$Ethnicity =="Unknown or Not Reported"] <- "Asian"
dat_check$race_eth[dat_check$Race == "More than one" & dat_check$Ethnicity =="Unknown or Not Reported" ] <- "Multi-racial"
dat_check$race_eth[dat_check$Race == "Unknown or Not Reported" & dat_check$Ethnicity =="Unknown or Not Reported" ] <- "Unknown or not reported"

dat_check$race_eth <- ordered(dat_check$race_eth, levels = c("White", "Black or African American"  , "Asian" ,
                                             "Multi-racial" , "Unknown or not reported and Hispanic","Multi-racial and Hispanic",
                                             "Black or African American and Hispanic", "White and Hispanic"))


```

## Unresitricted data
```{r, echo=FALSE}
unres<-read.table("~/Google Drive/HCP/HCP_graph/1200/datasets/unrestricted_gshearrer_4_19_2018_11_31_37.csv", header=T, sep=",")
myvars<-c("Subject","Gender","DDisc_SV_1mo_200","DDisc_SV_6mo_200","DDisc_SV_1yr_200","DDisc_SV_3yr_200","DDisc_SV_5yr_200",
             "DDisc_SV_10yr_200","DDisc_SV_1mo_40K","DDisc_SV_6mo_40K","DDisc_SV_1yr_40K","DDisc_SV_3yr_40K","DDisc_SV_5yr_40K",
             "DDisc_SV_10yr_40K","DDisc_AUC_200","DDisc_AUC_40K","ListSort_AgeAdj","CogFluidComp_AgeAdj","CogEarlyComp_AgeAdj",
             "CogTotalComp_AgeAdj","CogCrystalComp_AgeAdj","Endurance_AgeAdj",
             "GaitSpeed_Comp","Dexterity_AgeAdj","Strength_AgeAdj","Taste_AgeAdj")
unres<-unres[myvars]
unres$Subject<-unres$Subject
```
# joining individual sub data 
```{r, echo=FALSE}
data<-join(dat_check,unres)
dim(data)
head(data)
data$X<-as.factor(data$X)

quantile(data$PC)
data<-subset(data, data$PC > -4.100e+01)
sd(data$PC)

K=1.000e+00+1
hist(log10(K-data$PC), breaks = 100)
data$PC_log<-log10(K-data$PC)

hist(sqrt(data$centrality), breaks = 100)
data$centrality_sq<-sqrt(data$centrality)

hist(data$clustering, breaks = 100)
```


## Graph data
```{r, echo=FALSE}
graph_df<-read.table("~/Google Drive/HCP/HCP_graph/1200/datasets/tmp/submodule_data.csv", sep=",", header=T)
head(graph_df)
graph_df$group <- factor(graph_df$group, levels = c("normal","overweight","obese"))
summary(graph_df$X)

k=max(graph_df$PC)
hist(sqrt(k-graph_df$PC), breaks = 100)
graph_df$PC_sq<-sqrt(k-graph_df$PC)
  
hist(log10(graph_df$centrality), breaks = 100)
graph_df$centrality_log<-log10(graph_df$centrality)

kc<-max(graph_df$clustering)
hist(sqrt(kc-graph_df$clustering), breaks = 100)
graph_df$clustering_sq<-sqrt(kc-graph_df$clustering)
```

# Cleanup, center, ect
```{r, echo=FALSE}
cols <- c("Subject","Gender" ,"ZygosityGT", "Mother_ID","Father_ID","group","race_eth","modules","IC")

data %<>% mutate_at(cols, funs(factor(.)))
# str(data[100:114])
data$group <- ordered(data$group, levels = c("no", "ov", "ob"))
head(data)
```

```{r, echo=FALSE}
levels(graph_df$area)
graph_df$area<-revalue(graph_df$area, c("cerebellum"="Cerebellum"))
graph_df$area<-revalue(graph_df$area, c("None"=""))
graph_df$module<-as.factor(graph_df$module)
```
## Contrasts for demographics
```{r, echo=FALSE}
dat<-data[!duplicated(data[,c('Subject')]),]
levels(dat$group)    
levels(dat$race_eth)

#          no  ov  ob
cons<- list(
  noVov = c(1, -1,  0),
  noVob = c(1,  0, -1),
  ovVob = c(0,  1, -1)
) 
```
# Covariates
## Age
```{r, echo=FALSE}
dm1<-lm(Age_c~group, data=dat)
summary(dm1)
lsq_dm1 = lsmeans(dm1, "group")
contrast(lsq_dm1, cons, adjust='fdr')

violin(dat,dat$group,dat$Age_c)
describeBy(dat$Age_in_Yrs, dat$group)
## No difference in age 
```

# BMI
```{r, echo=FALSE}
dm2<-lm(BMI~group, data=dat)
lsq_dm2 = lsmeans(dm2, "group")
contrast(lsq_dm2, cons, adjust='fdr')
## Sanity check difference between the groups
violin(dat,dat$group,dat$BMI)
describeBy(dat$BMI, dat$group)
```

#HBA1c
```{r, echo=FALSE}
dm3<-lm(HBA1c_c~group, data=dat)
summary(dm3)
lsq_dm3 = lsmeans(dm3, "group")
contrast(lsq_dm3, cons, adjust='fdr')

violin(dat,dat$group,dat$HbA1C)
describeBy(dat$HbA1C, dat$group)
```


## sex
```{r, echo=FALSE}
chisq.test(table(dat$group, dat$Gender))
tapply(dat$group, dat$Gender, summary)

balloonplot(table(dat$group, dat$Gender), main ="Gender Frequencies", xlab ="", ylab="",
            label = TRUE, show.margins = FALSE, colsrt = 90,text.size=1.5 ,dotsize = 10, colmar=5, dotcolor=cbPalette)
```
## Race
```{r, echo=FALSE}
chisq.test(table(dat$group, dat$race_eth))
tapply(dat$group, dat$race_eth, summary)

balloonplot(table(dat$group, dat$race_eth), main ="Racial/Ethnic Frequencies", xlab ="", ylab="",
            label = TRUE, show.margins = FALSE, colsrt = 90,text.size=1.5 ,dotsize = 10, dotcolor=cbPalette, colmar=5)
```

# Models
```{r}
#took out FC
fit_function<-function(y,data){
  fit<-lm(y~group*IC+Age_c+HBA1c_c+Gender+race_eth, data=data)
  test.emm <- emmeans(fit, "group")
  contest<-emmeans(test.emm, pairwise ~ group)
  test.emm.s <- update(contest$contrasts, infer = c(TRUE, TRUE))
  return(summary(test.emm.s))
}

dfer<-function(X,Y){
  df<-data.frame(X,Y, stringsAsFactors=FALSE)
  return(df)
}
```


```{r}
# IC
warp <- transform(data, mods = interaction(group, IC))
head(warp)
# functional 
warp_func <- transform(graph_df, mods = interaction(group, area))
head(warp_func)
# mod
summary(graph_df$module)
mdf<-subset(graph_df, graph_df$module != 7)
mdf<-subset(mdf, mdf$module != 8)
mdf$module<-factor(mdf$module)
warp_mod <- transform(mdf, mods = interaction(group, module))
summary(warp_mod$module)
head(warp_mod)
```

# 3.3 Clustering coefficient
## 3.3.1 Nodal
After correcting for multiple comparisons (n=300), there were no differences in clustering coefficient between the BMI groups. Using a less stringent correction for multiple comparison (n=3 per node), in node 22 the aBMI group exhibited higher clustering coefficient compared to the hBMI group (t-ratio = 2.84, SE=0.02, pFDR3 = 0.01). In node 73, the aBMI group has higher clustering coefficient compared to the vhBMI group (t-ratio= 2.62, SE= 0.01, pFDR3= 0.01), and the hBMI group showed increased clustering coefficient compared the the vhBMI group (t-ratio= 3.20, SE= 0.01, pFDR3= 0.004). 

```{r}
library(ggpubr)
CC.gls <- gls(clustering ~ mods+Gender+race_eth+HbA1C, data = warp, na.action = na.omit)
CC.emm <- emmeans(CC.gls, "mods")
CC.fac <- update(CC.emm, levels = list(
                group = c("normal", "overweight", "obese"), 
                area = c("0","1","2","3","4","5","6","7","8","9","10",
                         "11","12","13","14","15","16","17","18","19","20",
                         "21","22","23","24","25","26","27","28","29","30",
                         "31","32","33","34","35","36","37","38","39","40",
                         "41","42","43","44","45","46","47","48","49","50",
                         "51","52","53","54","55","56","57","58","59","60",
                         "61","62","63","64","65","66","67","68","69","70",
                         "71","72","73","74","75","76","77","78","79","80",
                         "81","82","83","84","85","86","87","88","89","90",
                         "91","92","93","94","95","96","97","98","99")))

contrast(CC.fac, "pairwise", by = "area", adjust = "fdr")
levels(warp$mods)
IC22<-subset(warp, warp$IC == "IC_22")
IC22p<-violin(IC22, IC22$mods, IC22$clustering)
IC73<-subset(warp, warp$IC == "IC_73")
IC73p<-violin(IC73, IC73$mods, IC73$clustering)
ggarrange(IC22p, IC73p, 
          labels = c("IC_22", "IC_73"),
          ncol = 2)
```
# 3.3.2 Functional Networks
No differences in any functional networks were seen between the BMI groups. 
```{r}
CC.gls <- gls(clustering ~ mods, data = warp_func)
CC.emm <- emmeans(CC.gls, "mods")
CC.fac <- update(CC.emm, levels = list(
                group = c("normal", "overweight", "obese"), 
                area = c("","Amygdala", "Auditory", "BrainStem", "Caudate", "Cerebellum", "CinguloOperc",
                         "Default", "DorsalAttn", "FrontoParietal", "MedialParietal", "Putamen",
                         "Smhand", "Smmouth", "Thalamus", "VentralAttn", "VentralDiencephalon", "Visual")))

contrast(CC.fac, "pairwise", by = "area", adjust = "fdr")
```
## 3.3.3 Modules
Between the sensory modules, aBMI module 2 trended towards increased clustering coefficient compared to the vhBMI module 4 (t-ratio=2.23 , SE= 0.02, pFDR= 0.09). The aBMI group additionally showed increased clustering coefficients within the subcortical module (module 5) compared to the vhBMI subcortical module (module 6) (t-ratio= 2.79, SE= 0.02, pFDR= 0.03).

```{r}
# mod
summary(graph_df$module)
mdf<-subset(graph_df, graph_df$module != 7)
mdf<-subset(mdf, mdf$module != 8)
mdf$module<-factor(mdf$module)
```
### visual 
```{r}
warp_mod <- transform(mdf, mods = interaction(group, module))

warp_mod$visual <- NA
warp_mod[warp_mod$mods == 'normal.0', "visual"] <- 'aBMI2'
warp_mod[warp_mod$mods == 'overweight.0', "visual"] <- 'hBMI2'
warp_mod[warp_mod$mods == 'obese.0', "visual"] <- 'vhBMI4'

CC0.gls <- gls(clustering ~ visual, data = warp_mod, na.action = na.omit)
CC0.emm <- emmeans(CC0.gls, "visual")

contrast(CC0.emm, "pairwise",  adjust = "fdr")
```
### Sensory 
```{r}
warp_mod <- transform(mdf, mods = interaction(group, module))

# no.2.5 vs. ov.2.6 vs. ob.4.6
warp_mod$sensory <- NA
warp_mod[warp_mod$mods == 'normal.2', "sensory"] <- 'aBMI2'
warp_mod[warp_mod$mods == 'overweight.2', "sensory"] <- 'hBMI2'
warp_mod[warp_mod$mods == 'obese.4', "sensory"] <- 'vhBMI4'

CC0.gls <- gls(clustering ~ sensory, data = warp_mod, na.action = na.omit)
CC0.emm <- emmeans(CC0.gls, "sensory")

contrast(CC0.emm, "pairwise",  adjust = "fdr")
warp_mod<-warp_mod[complete.cases(warp_mod$sensory), ] 
SenCCp<-violin(warp_mod, warp_mod$sensory, warp_mod$clustering)
SenCCp
```
### DMN
```{r}
warp_mod <- transform(mdf, mods = interaction(group, module))

warp_mod$DMN <- NA
warp_mod[warp_mod$mods == 'normal.1', "DMN"] <- 'aBMI2'
warp_mod[warp_mod$mods == 'overweight.1', "DMN"] <- 'hBMI2'
warp_mod[warp_mod$mods == 'obese.1', "DMN"] <- 'vhBMI4'

CC0.gls <- gls(clustering ~ DMN, data = warp_mod, na.action = na.omit)
CC0.emm <- emmeans(CC0.gls, "DMN")

contrast(CC0.emm, "pairwise",  adjust = "fdr")
```
### subcortical
```{r}
warp_mod <- transform(mdf, mods = interaction(group, module))

warp_mod$subcort <- NA
warp_mod[warp_mod$mods == 'normal.5', "subcort"] <- 'aBMI5'
warp_mod[warp_mod$mods == 'overweight.6', "subcort"] <- 'hBMI6'
warp_mod[warp_mod$mods == 'obese.6', "subcort"] <- 'vhBMI6'


CC0.gls <- gls(clustering ~ subcort, data = warp_mod, na.action = na.omit)
CC0.emm <- emmeans(CC0.gls, "subcort")

contrast(CC0.emm, "pairwise",  adjust = "fdr")
warp_mod<-warp_mod[complete.cases(warp_mod$subcort), ] 
SubCCp<-violin(warp_mod, warp_mod$subcort, warp_mod$clustering)
SubCCp
```
### other
```{r}
warp_mod <- transform(mdf, mods = interaction(group, module))

warp_mod$other <- NA
warp_mod[warp_mod$mods == 'normal.3', "other"] <- 'aBMI2'
warp_mod[warp_mod$mods == 'overweight.3', "other"] <- 'hBMI2'
warp_mod[warp_mod$mods == 'obese.3', "other"] <- 'vhBMI4'


CC0.gls <- gls(clustering ~ other, data = warp_mod, na.action = na.omit)
CC0.emm <- emmeans(CC0.gls, "other")

contrast(CC0.emm, "pairwise",  adjust = "fdr")
```

# 3.6 Betweenness centrality
## 3.6.1 Nodal
No differences were detected between BMI groups after correcting for multiple comparisons (n=300). Using the less stringent multiple comparison correction (n=3),  in node 13 the aBMI group had higher centrality compared to the hBMI group (t-ratio= 2.09, SE= 0.002, pFDR3= 0.05), and the vhBMI had higher centrality compared to the hBMI group (t-ratio= -2.83, SE= 0.003, pFDR3= 0.01). In node 17, the hBMI had higher centrality compared to both the aBMI (t-ratio= -2.38, SE= 0.002, pFDR3= 0.03) and vhBMI (t-ratio= 2.44, SE= 0.002, pFDR3= 0.03) groups. In node 41, the aBMI had higher centrality compared to the hBMI (t-ratio= 2.39, SE= 0.002, pFDR3= 0.02), and the vhBMI group exhibited higher centrality compared to the hBMI group (t-ratio= -3.47, SE= 0.003, pFDR3= 0.001). In node 50, the hBMI group exhibited lower centrality compared to both the aBMI (t-ratio= 2.85, SE= 0.002, pFDR3= 0.01) and the vhBMI (t-ratio= -1.94, SE= 0.003, pFDR3= 0.08) groups. In node 86, the vhBMI group exhibited decreased centrality compared to both the aBMI (t-ratio= 2.56, SE= 0.002, pFDR3= 0.02) and the hBMI (t-ratio= 3.02, SE= 0.002, pFDR3= 0.01) groups. 
```{r}
Cen.gls <- gls(centrality_sq ~ mods+Gender+race_eth+HbA1C, data = warp, na.action = na.omit)
Cen.emm <- emmeans(Cen.gls, "mods")
Cen.fac <- update(Cen.emm, levels = list(
                group = c("normal", "overweight", "obese"), 
                area = c("0","1","2","3","4","5","6","7","8","9","10",
                         "11","12","13","14","15","16","17","18","19","20",
                         "21","22","23","24","25","26","27","28","29","30",
                         "31","32","33","34","35","36","37","38","39","40",
                         "41","42","43","44","45","46","47","48","49","50",
                         "51","52","53","54","55","56","57","58","59","60",
                         "61","62","63","64","65","66","67","68","69","70",
                         "71","72","73","74","75","76","77","78","79","80",
                         "81","82","83","84","85","86","87","88","89","90",
                         "91","92","93","94","95","96","97","98","99")))

contrast(Cen.fac, "pairwise", by = "area", adjust = "fdr")
#node13, node18, node41, node50, node86
IC13<-subset(warp, warp$IC == "IC_13")
IC13p<-violin(IC13, IC13$mods, IC13$centrality)
IC17<-subset(warp, warp$IC == "IC_17")
IC17p<-violin(IC17, IC17$mods, IC17$centrality)
IC41<-subset(warp, warp$IC == "IC_41")
IC41p<-violin(IC41, IC41$mods, IC41$centrality)
IC50<-subset(warp, warp$IC == "IC_50")
IC50p<-violin(IC50, IC50$mods, IC50$centrality)
IC86<-subset(warp, warp$IC == "IC_86")
IC86p<-violin(IC86, IC86$mods, IC86$centrality)

ggarrange(IC13p, IC17p, IC41p, IC50p, IC86p,
          ncol = 2, nrows = 3)
```

## 3.6.2 Functional Networks
No differences in any functional networks were seen between the BMI groups.
```{r}
Cen.gls <- gls(centrality_log ~ mods, data = warp_func)
Cen.emm <- emmeans(Cen.gls, "mods")
Cen.fac <- update(Cen.emm, levels = list(
                group = c("normal", "overweight", "obese"), 
                area = c("","Amygdala", "Auditory", "BrainStem", "Caudate", "Cerebellum", "CinguloOperc",
                         "Default", "DorsalAttn", "FrontoParietal", "MedialParietal", "Putamen",
                         "Smhand", "Smmouth", "Thalamus", "VentralAttn", "VentralDiencephalon", "Visual")))

contrast(Cen.fac, "pairwise", by = "area", adjust = "fdr")
```

## 3.6.3 Module 
The aBMI visual module (module 0) showed increased betweenness centrality compared to the vhBMI visual module (module 0) (t-ratio= 3.07, SE= 0.11, pFDR3= 0.009). The hBMI visual module (module 0) also showed increased betweenness centrality compared to the vhBMI visual module (t-ratio= 3.14, SE= 0.11, pFDR3= 0.009). 

### visual 
```{r}
warp_mod <- transform(mdf, mods = interaction(group, module))

warp_mod$visual <- NA
warp_mod[warp_mod$mods == 'normal.0', "visual"] <- 'aBMI2'
warp_mod[warp_mod$mods == 'overweight.0', "visual"] <- 'hBMI2'
warp_mod[warp_mod$mods == 'obese.0', "visual"] <- 'vhBMI4'

Cen0.gls <- gls(centrality_log ~ visual, data = warp_mod, na.action = na.omit)
Cen0.emm <- emmeans(Cen0.gls, "visual")

contrast(Cen0.emm, "pairwise",  adjust = "fdr")

warp_mod<-warp_mod[complete.cases(warp_mod$visual), ] 
VizCenp<-violin(warp_mod, warp_mod$visual, warp_mod$centrality)
VizCenp
```
### Sensory 
```{r}
warp_mod$sensory <- NA
warp_mod[warp_mod$mods == 'normal.2', "sensory"] <- 'aBMI2'
warp_mod[warp_mod$mods == 'overweight.2', "sensory"] <- 'hBMI2'
warp_mod[warp_mod$mods == 'obese.4', "sensory"] <- 'vhBMI4'

Cen0.gls <- gls(centrality_log ~ sensory, data = warp_mod, na.action = na.omit)
Cen0.emm <- emmeans(Cen0.gls, "sensory")

contrast(Cen0.emm, "pairwise",  adjust = "fdr")
```
### DMN
```{r}
warp_mod <- transform(mdf, mods = interaction(group, module))

warp_mod$DMN <- NA
warp_mod[warp_mod$mods == 'normal.1', "DMN"] <- 'aBMI2'
warp_mod[warp_mod$mods == 'overweight.1', "DMN"] <- 'hBMI2'
warp_mod[warp_mod$mods == 'obese.1', "DMN"] <- 'vhBMI4'

Cen0.gls <- gls(centrality_log ~ DMN, data = warp_mod, na.action = na.omit)
Cen0.emm <- emmeans(Cen0.gls, "DMN")

contrast(Cen0.emm, "pairwise",  adjust = "fdr")
```
### subcortical
```{r}
warp_mod <- transform(mdf, mods = interaction(group, module))

warp_mod$subcort <- NA
warp_mod[warp_mod$mods == 'normal.5', "subcort"] <- 'aBMI5'
warp_mod[warp_mod$mods == 'overweight.6', "subcort"] <- 'hBMI6'
warp_mod[warp_mod$mods == 'obese.6', "subcort"] <- 'vhBMI6'


Cen0.gls <- gls(centrality_log ~ subcort, data = warp_mod, na.action = na.omit)
Cen0.emm <- emmeans(Cen0.gls, "subcort")

contrast(Cen0.emm, "pairwise",  adjust = "fdr")
```
### other
```{r}
warp_mod <- transform(mdf, mods = interaction(group, module))

warp_mod$other <- NA
warp_mod[warp_mod$mods == 'normal.3', "other"] <- 'aBMI2'
warp_mod[warp_mod$mods == 'overweight.3', "other"] <- 'hBMI2'
warp_mod[warp_mod$mods == 'obese.3', "other"] <- 'vhBMI4'


Cen0.gls <- gls(centrality_log ~ other, data = warp_mod, na.action = na.omit)
Cen0.emm <- emmeans(Cen0.gls, "other")

contrast(Cen0.emm, "pairwise",  adjust = "fdr")
```


# 3.4 Participation coefficient
## 3.4.1 Nodal
No differences between groups by nodal participation coefficient were observed with the more stringent (n=300) correction. Using the less stringent (n=3) correction for multiple comparisons, in node 13  the hBMI group exhibited higher participation coefficient compared to both the aBMI (t-ratio= -2.38, SE= 0.06, pFDR3= 0.03) and the vhBMI groups (t-ratio= 2.88, SE= 0.08, pFDR3= 0.01). In area 32, the hBMI again showed increased participation coefficient compared to the aBMI group (t-ratio= -2.49, SE= 0.07, pFDR3= 0.04). 

```{r}
colnames(warp)
warp$PC_z<-scale(warp$PC)
# describeBy(warp$PC_z, warp$group)
# warp<-subset(warp, warp$PC_z > -0.03)
violin(d = warp, x = warp$group, y = warp$PC_z)
PC.gls <- gls(PC_log ~ mods+Gender+race_eth+HbA1C, data = warp, na.action = na.omit)
PC.emm <- emmeans(PC.gls, "mods")
PC.fac <- update(PC.emm, levels = list(
                group = c("no", "ov", "ob"), 
                area = c("0","1","2","3","4","5","6","7","8","9","10",
                         "11","12","13","14","15","16","17","18","19","20",
                         "21","22","23","24","25","26","27","28","29","30",
                         "31","32","33","34","35","36","37","38","39","40",
                         "41","42","43","44","45","46","47","48","49","50",
                         "51","52","53","54","55","56","57","58","59","60",
                         "61","62","63","64","65","66","67","68","69","70",
                         "71","72","73","74","75","76","77","78","79","80",
                         "81","82","83","84","85","86","87","88","89","90",
                         "91","92","93","94","95","96","97","98","99")))

contrast(PC.fac, "pairwise", by = "area", adjust = "fdr")
#node13, node32
IC13<-subset(warp, warp$IC == "IC_13")
IC13p<-violin(IC13, IC13$mods, IC13$PC_z)
IC32<-subset(warp, warp$IC == "IC_32")
IC32p<-violin(IC32, IC32$mods, IC32$PC_z)

ggarrange(IC13p, IC32p,
          ncol = 2)
```
## 3.4.2 Functional Networks
Within the auditory functional network the vhBMI group showed decreased participation coefficient compared to both the aBMI (t-ratio= 2.15, SE= 0.18, pFDR= 0.05) and the hBMI groups (t-ratio= 2.17, SE= 0.18, pFDR= 0.05). The participation coefficient in the somatosensory hand network for the vhBMI was lower compared to the aBMI (t-ratio= 3.40, SE= 0.09, pFDR= 0.002) and the hBMI (t-ratio=3.30 , SE= 0.09, pFDR= 0.002) groups. This pattern was also observed in the somatosensory mouth network, with the vhBMI showing a lower participation coefficient compared to the aBMI group (t-ratio= 2.60, SE= 0.13, pFDR= 0.01) and the hBMI (t-ratio= 2.61, SE= 0.13, pFDR= 0.01) group.  
```{r}
warp_func$PC_z<-scale(warp_func$PC)
# warp_func<-subset(warp_func, warp_func$PC_z > -3)
# colnames(warp_func)
PC.gls <- gls(PC_sq ~ mods, data = warp_func, na.action = na.omit)
PC.emm <- emmeans(PC.gls, "mods")
PC.fac <- update(PC.emm, levels = list(
                group = c("normal", "overweight", "obese"), 
                area = c("","Amygdala", "Auditory", "BrainStem", "Caudate", "Cerebellum", "CinguloOperc",
                         "Default", "DorsalAttn", "FrontoParietal", "MedialParietal", "Putamen",
                         "Smhand", "Smmouth", "Thalamus", "VentralAttn", "VentralDiencephalon", "Visual")))

contrast(PC.fac, "pairwise", by = "area", adjust = "fdr")

warp_mod<-warp_mod[complete.cases(warp_mod$visual), ] 

#node13, node32

aud<-subset(warp_func, warp_func$area == "Auditory")
aud<-aud[complete.cases(aud$area), ] 
aud$mods<-factor(aud$mods)
describeBy(aud$PC, aud$mods)

smH<-subset(warp_func, warp_func$area ==  "Smhand")
smH$mods<-factor(smH$mods)
smHp<-violin(smH, smH$mods, smH$PC_z)
smHp

smM<-subset(warp_func, warp_func$area ==  "Smmouth")
smM$mods<-factor(smM$mods)
smMp<-violin(smM, smM$mods, smM$PC_z)
describeBy(smM$PC_sq, smM$mods)
```

## 3.4.3 Module
Within the visual modules, the vhBMI showed lower participation coefficients compared to both the aBMI (t-ratio= -5.60, SE= 0.04, pFDR< 0.0001) and the hBMI groups (t-ratio=-4.98, SE= 0.04, pFDR= 0.0001). Conversely, the participation coefficient for the vhBMI was higher in the sensory module (module 4) compared to the aBMI (module 2) (t-ratio=-10.27 , SE= 0.03 pFDR< 0.0001 ) and hBMI (module 2) (t-ratio= 9.93, SE= 0.03, pFDR< 0.0001). 

### visual 
```{r}
warp_mod <- transform(mdf, mods = interaction(group, module))

warp_mod$PC_z<-scale(warp_mod$PC)
# warp_mod<-subset(warp_mod, warp_mod$PC_z > -3)

head(warp_mod)
warp_mod$visual <- NA
warp_mod[warp_mod$mods == 'normal.0', "visual"] <- 'aBMI0'
warp_mod[warp_mod$mods == 'overweight.0', "visual"] <- 'hBMI0'
warp_mod[warp_mod$mods == 'obese.0', "visual"] <- 'vhBMI0'

PC0.gls <- gls(PC_sq ~ visual, data = warp_mod, na.action = na.omit)
PC0.emm <- emmeans(PC0.gls, "visual")

contrast(PC0.emm, "pairwise",  adjust = "fdr")

warp_mod<-warp_mod[complete.cases(warp_mod$visual), ] 
VizPCp<-violin(warp_mod, warp_mod$visual, warp_mod$PC_z)
VizPCp
```
### Sensory 
```{r}
warp_mod <- transform(mdf, mods = interaction(group, module))
warp_mod$PC_z<-scale(warp_mod$PC)

warp_mod$sensory <- NA
warp_mod[warp_mod$mods == 'normal.2', "sensory"] <- 'aBMI2'
warp_mod[warp_mod$mods == 'overweight.2', "sensory"] <- 'hBMI2'
warp_mod[warp_mod$mods == 'obese.4', "sensory"] <- 'vhBMI4'

PC0.gls <- gls(PC_sq ~ sensory, data = warp_mod, na.action = na.omit)
PC0.emm <- emmeans(PC0.gls, "sensory")

contrast(PC0.emm, "pairwise",  adjust = "fdr")
warp_mod<-warp_mod[complete.cases(warp_mod$sensory), ] 
SenPCp<-violin(warp_mod, warp_mod$sensory, warp_mod$PC_z)
SenPCp
```
### DMN
```{r}
warp_mod$DMN <- NA
warp_mod[warp_mod$mods == 'normal.1', "DMN"] <- 'aBMI1'
warp_mod[warp_mod$mods == 'overweight.1', "DMN"] <- 'hBMI1'
warp_mod[warp_mod$mods == 'obese.1', "DMN"] <- 'vhBMI1'

PC0.gls <- gls(PC_sq ~ DMN, data = warp_mod, na.action = na.omit)
PC0.emm <- emmeans(PC0.gls, "DMN")

contrast(PC0.emm, "pairwise",  adjust = "fdr")
```
### subcortical
```{r}
warp_mod$subcort <- NA
warp_mod[warp_mod$mods == 'normal.5', "subcort"] <- 'aBMI5'
warp_mod[warp_mod$mods == 'overweight.6', "subcort"] <- 'hBMI6'
warp_mod[warp_mod$mods == 'obese.6', "subcort"] <- 'vhBMI6'


PC0.gls <- gls(PC_sq ~ subcort, data = warp_mod, na.action = na.omit)
PC0.emm <- emmeans(PC0.gls, "subcort")

contrast(PC0.emm, "pairwise",  adjust = "fdr")
```
### other
```{r}
warp_mod$other <- NA
warp_mod[warp_mod$mods == 'normal.3', "other"] <- 'aBMI2'
warp_mod[warp_mod$mods == 'overweight.3', "other"] <- 'hBMI2'
warp_mod[warp_mod$mods == 'obese.3', "other"] <- 'vhBMI4'


PC0.gls <- gls(PC_sq ~ other, data = warp_mod, na.action = na.omit)
PC0.emm <- emmeans(PC0.gls, "other")

contrast(PC0.emm, "pairwise",  adjust = "fdr")
```


# 3.7 Post Hoc Comparison with behavioral measures
## Data prep
```{r}
colnames(graph_df)
sub<-c("area","IC")
area<-graph_df[sub]
head(area)
df<-join(area, data)
```

```{r}
# mod
df$module<-as.factor(df$module)
summary(df$module)
module_df<-subset(df, df$module != 7)
module_df<-subset(module_df, module_df$module != 8)
module_df$module <- factor(module_df$module)
summary(module_df$module)
```
## Function 
```{r}
# y is behavioral measure
# x is the group
# z is the graph measures

fit_function<-function(x,y,z,data){
  x<-unlist(x)
  y <- unlist(y)
  z<-unlist(z)
  fit<-lm(y~z*x+Age_c+race_eth+Gender, data=data, na.action = na.omit)#
  return(fit)
}
```
## By funtional network 
## 3.7.1 Participation coeff
### 3.7.1.1 Auditory
```{r}
# View(module_df)
warp_1 <- transform(module_df, mods = interaction(group, area))
warp_1$PC_z<-scale(warp_1$PC)

warp_1$auditory <- NA
warp_1[warp_1$mods == 'no.Auditory', "auditory"] <- 'aBMIauditory'
warp_1[warp_1$mods == 'ov.Auditory', "auditory"] <- 'hBMIauditory'
warp_1[warp_1$mods == 'ob.Auditory', "auditory"] <- 'vhBMIauditory'
colnames(warp_1)
```

```{r}
# y is behavioral measure
# x is the group
# z is the graph measures
names<-colnames(warp_1[28:52])

aud <- list()
for (i in seq(28, 52, by= 1)){
  print(paste("start", i))
  out<-fit_function(x=warp_1[57], y = warp_1[i], z=warp_1[52], data = warp_1)
  test.emm <- emmeans(out, ~ x*z)
  df<-data.frame(contrast(test.emm, "pairwise",  adjust = "fdr"))
  aud[[i]] <-list(out,df, test.emm)
}

aud2<-list()
for(i in seq(1, 24, by = 1)){
  print(paste ("this is ",i))
  df<-aud[28:64][[i]][[2]]
  df$var<-names[i]
  aud2[[i]] <-list(df)
  }

df_PCaud<-bind_rows(aud2)
df_PCaud$pFDR<-p.adjust(df_PCaud$p.value, method = "BH")
PC_auditory<-df_PCaud[df_PCaud$pFDR <= 0.05, ] 
PC_auditory
```


### 3.7.1.2 Somatosensory hand
```{r}
# View(module_df)
warp_1 <- transform(module_df, mods = interaction(group, area))
warp_1$PC_z<-scale(warp_1$PC)
warp_1$Smhand <- NA
warp_1[warp_1$mods == 'no.Smhand', "Smhand"] <- 'aBMISmhand'
warp_1[warp_1$mods == 'ov.Smhand', "Smhand"] <- 'hBMISmhand'
warp_1[warp_1$mods == 'ob.Smhand', "Smhand"] <- 'vhBMISmhand'
colnames(warp_1)
```


```{r}
# y is behavioral measure
# x is the group
# z is the graph measures
names<-colnames(warp_1[28:52])

smhand <- list()
for (i in seq(28, 52, by= 1)){
  print(paste("start", i))
  out<-fit_function(x=warp_1[56], y = warp_1[i], z=warp_1[52], data = warp_1)
  test.emm <- emmeans(out, ~ x*z)
  df<-data.frame(contrast(test.emm, "pairwise",  adjust = "fdr"))
  smhand[[i]] <-list(out,df, test.emm)
}

smhand2<-list()
for(i in seq(1, 24, by = 1)){
  print(paste ("this is ",i))
  df<-smhand[28:64][[i]][[2]]
  df$var<-names[i]
  smhand2[[i]] <-list(df)
  }
df_PChand<-bind_rows(smhand2)
df_PChand$pFDR<-p.adjust(df_PChand$p.value, method = "BH")
PC_hand<-df_PChand[df_PChand$pFDR <= 0.05, ] 
PC_hand
#Working Memory (List Sorting)
#Cognitive Function Composite score
#Crystallized Cognition Composite score
warp_1<-warp_1[complete.cases(warp_1$Smhand), ] 

dex<-ggplot(warp_1, aes(x=PC_z, y=Dexterity_AgeAdj, color=Smhand)) +
    geom_point(shape=1, alpha = 0.25) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

CFC<-ggplot(warp_1, aes(x=PC_z, y=CogTotalComp_AgeAdj, color=Smhand)) +
    geom_point(shape=1, alpha = 0.25) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

Crystal<-ggplot(warp_1, aes(x=PC_z, y=CogCrystalComp_AgeAdj, color=Smhand)) +
    geom_point(shape=1, alpha = 0.25) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

ggarrange(dex, CFC, Crystal,
          ncol = 2, nrow = 2)
```
#### somatosensory mouth 
```{r}
# View(module_df)
warp_1 <- transform(module_df, mods = interaction(group, area))

warp_1$Smmouth <- NA
warp_1[warp_1$mods == 'no.Smmouth', "Smmouth"] <- 'aBMISmmouth'
warp_1[warp_1$mods == 'ov.Smmouth', "Smmouth"] <- 'hBMISmmouth'
warp_1[warp_1$mods == 'ob.Smmouth', "Smmouth"] <- 'vhBMISmmouth'
colnames(warp_1)
```


```{r}
# y is behavioral measure
# x is the group
# z is the graph measures
names<-colnames(warp_1[28:52])

smmouth <- list()
for (i in seq(28, 52, by= 1)){
  print(paste("start", i))
  out<-fit_function(x=warp_1[56], y = warp_1[i], z=warp_1[52], data = warp_1)
  test.emm <- emmeans(out, ~ x*z)
  df<-data.frame(contrast(test.emm, "pairwise",  adjust = "fdr"))
  smmouth[[i]] <-list(out,df, test.emm)
}

smmouth2<-list()
for(i in seq(1, 24, by = 1)){
  print(paste ("this is ",i))
  df<-smmouth[28:64][[i]][[2]]
  df$var<-names[i]
  smmouth2[[i]] <-list(df)
  }
df_PCmouth<-bind_rows(smmouth2)
df_PCmouth$pFDR<-p.adjust(df_PCmouth$p.value, method = "BH")
PC_mouth<-df_PCmouth[df_PCmouth$pFDR <= 0.05, ] 
PC_mouth

#Taste_AgeAdj
#ListSort_AgeAdj
#CogTotalComp_AgeAdj
warp_1$PC_z<-scale(warp_1$PC)
warp_1<-warp_1[complete.cases(warp_1$Smmouth), ] 

taste<-ggplot(warp_1, aes(x=PC_z, y=Taste_AgeAdj, color=Smmouth)) +
    geom_point(shape=1, alpha = 0.25) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

WM<-ggplot(warp_1, aes(x=PC_z, y=ListSort_AgeAdj, color=Smmouth)) +
    geom_point(shape=1, alpha = 0.25) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

cog<-ggplot(warp_1, aes(x=PC_z, y=CogTotalComp_AgeAdj, color=Smmouth)) +
    geom_point(shape=1, alpha = 0.25) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

ggarrange(taste, WM, cog,
          ncol = 2, nrow = 2)
```

### Participation coeff
#### visual
```{r}
warp_2 <- transform(module_df, mods = interaction(group, module))

warp_2$visual <- NA
warp_2[warp_2$mods == 'no.0', "visual"] <- 'aBMI0'
warp_2[warp_2$mods == 'ov.0', "visual"] <- 'hBMI0'
warp_2[warp_2$mods == 'ob.0', "visual"] <- 'vhBMI0'
colnames(warp_2)
```

```{r}
# y is behavioral measure
# x is the group
# z is the graph measures
names<-colnames(warp_2[28:52])

visualmod <- list()
for (i in seq(28, 52, by= 1)){
  print(paste("start", i))
  out<-fit_function(x=warp_2[56], y = warp_2[i], z=warp_2[52], data = warp_2)
  test.emm <- emmeans(out, ~ x*z)
  df<-data.frame(contrast(test.emm, "pairwise",  adjust = "fdr"))
  visualmod[[i]] <-list(out,df, test.emm)
}

visualmod2<-list()
for(i in seq(1, 24, by = 1)){
  print(paste ("this is ",i))
  df<-visualmod[28:64][[i]][[2]]
  df$var<-names[i]
  visualmod2[[i]] <-list(df)
  }

df_PCviz<-bind_rows(visualmod2)
df_PCviz$pFDR<-p.adjust(df_PCviz$p.value, method = "BH")
PC_visualmod<-df_PCviz[df_PCviz$pFDR <= 0.05, ] 
PC_visualmod

# ListSort_AgeAdj
# CogTotalComp_AgeAdj
# DDisc_AUC_40K
warp_2$PC_z<-scale(warp_2$PC)
warp_2<-warp_2[complete.cases(warp_2$visual), ] 

WMvis<-ggplot(warp_2, aes(x=PC_log, y=ListSort_AgeAdj, color=visual)) +
    geom_point(shape=1, alpha = 0.25) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()
WMvis
cogvis<-ggplot(warp_2, aes(x=PC_log, y=CogTotalComp_AgeAdj, color=visual)) +
    geom_point(shape=1, alpha = 0.25) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

ddvis<-ggplot(warp_2, aes(x=PC_log, y=DDisc_AUC_40K, color=visual)) +
    geom_point(shape=1, alpha = 0.25) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

ggarrange(WMvis, cogvis, ddvis,
          ncol = 2, nrow = 2)
```

#### Sensory 
```{r}
warp_2 <- transform(module_df, mods = interaction(group, module))

warp_2$sensory <- NA
warp_2[warp_2$mods == 'no.2', "sensory"] <- 'aBMI2'
warp_2[warp_2$mods == 'ov.2', "sensory"] <- 'hBMI2'
warp_2[warp_2$mods == 'ob.4', "sensory"] <- 'vhBMI4'
colnames(warp_2)
```

```{r}
# y is behavioral measure
# x is the group
# z is the graph measures
names<-colnames(warp_2[28:52])

sensorymod <- list()
for (i in seq(28, 52, by= 1)){
  print(paste("start", i))
  out<-fit_function(x=warp_2[56], y = warp_2[i], z=warp_2[52], data = warp_2)
  test.emm <- emmeans(out, ~ x*z)
  df<-data.frame(contrast(test.emm, "pairwise",  adjust = "fdr"))
  sensorymod[[i]] <-list(out,df, test.emm)
}

sensorymod2<-list()
for(i in seq(1, 24, by = 1)){
  print(paste ("this is ",i))
  df<-sensorymod[28:64][[i]][[2]]
  df$var<-names[i]
  sensorymod2[[i]] <-list(df)
  }
df_PCsen<-bind_rows(sensorymod2)
df_PCsen$pFDR<-p.adjust(df_PCsen$p.value, method = "BH")
PC_sensorymod<-df_PCsen[df_PCsen$pFDR <= 0.05, ] 
PC_sensorymod


# Taste_AgeAdj
# CogTotalComp_AgeAdj
# DDisc_AUC_200
warp_2$PC_z<-scale(warp_2$PC)
warp_2<-warp_2[complete.cases(warp_2$sensory), ] 

WMsen<-ggplot(warp_2, aes(x=PC_log, y=Taste_AgeAdj, color=sensory)) +
    geom_point(shape=1, alpha = 0.05) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

cogsen<-ggplot(warp_2, aes(x=PC_log, y=CogTotalComp_AgeAdj, color=sensory)) +
    geom_point(shape=1, alpha = 0.05) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

ddsen<-ggplot(warp_2, aes(x=PC_log, y=DDisc_AUC_200, color=sensory)) +
    geom_point(shape=1, alpha = 0.05) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

ggarrange(WMsen, cogsen, ddsen,
          ncol = 2, nrow = 2)
```
### Betweennness centrality 
#### visual
```{r}
warp_3 <- transform(module_df, mods = interaction(group, module))

warp_3$visual <- NA
warp_3[warp_3$mods == 'no.0', "visual"] <- 'aBMI0'
warp_3[warp_3$mods == 'ov.0', "visual"] <- 'hBMI0'
warp_3[warp_3$mods == 'ob.0', "visual"] <- 'vhBMI0'
colnames(warp_3)
```

```{r}
# y is behavioral measure
# x is the group
# z is the graph measures
names<-colnames(warp_3[28:52])

visualmod <- list()
for (i in seq(28, 52, by= 1)){
  print(paste("start", i))
  out<-fit_function(x=warp_3[56], y = warp_3[i], z=warp_3[53], data = warp_3)
  test.emm <- emmeans(out, ~ x*z)
  df<-data.frame(contrast(test.emm, "pairwise",  adjust = "fdr"))
  visualmod[[i]] <-list(out,df, test.emm)
}

visualmod2<-list()
for(i in seq(1, 24, by = 1)){
  print(paste ("this is ",i))
  df<-visualmod[28:52][[i]][[2]]
  df$var<-names[i]
  visualmod2[[i]] <-list(df)
  }
df_Cenviz<-bind_rows(visualmod2)
df_Cenviz$pFDR<-p.adjust(df_Cenviz$p.value, method = "BH")
CEN_visualmod<-df_Cenviz[df_Cenviz$pFDR <= 0.05, ] 
CEN_visualmod


#  ListSort_AgeAdj
# CogTotalComp_AgeAdj
# DDisc_AUC_200
warp_3<-warp_3[complete.cases(warp_3$visual), ] 

WMvis<-ggplot(warp_3, aes(x=centrality, y= ListSort_AgeAdj, color=visual)) +
    geom_point(shape=1, alpha = 0.05) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

cogvis<-ggplot(warp_3, aes(x=centrality, y=CogTotalComp_AgeAdj, color=visual)) +
    geom_point(shape=1, alpha = 0.05) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

ddvis<-ggplot(warp_3, aes(x=centrality, y=DDisc_AUC_40K, color=visual)) +
    geom_point(shape=1, alpha = 0.05) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

ggarrange(WMvis, cogvis, ddvis,
          ncol = 2, nrow = 2)
```
## Clustering coefficient 
#### Sensory 
```{r}
warp_X <- transform(module_df, mods = interaction(group, module))
levels(warp_X$mods)
warp_X$sensory <- NA
warp_X[warp_X$mods == "no.2", "sensory"] <- 'aBMI2'
warp_X[warp_X$mods == "ov.2", "sensory"] <- 'hBMI2'
warp_X[warp_X$mods == "ob.4", "sensory"] <- 'vhBMI4'
warp_X$sensory<-as.factor(warp_X$sensory)
colnames(warp_X)
```

```{r}
# y is behavioral measure
# x is the group
# z is the graph measures
names<-colnames(warp_X[28:52])

sensorymod <- list()
for (i in seq(28, 52, by= 1)){
  print(paste("start", i))
  out<-fit_function(x=warp_X[56], y = warp_X[i], z=warp_X[19], data = warp_X)
  test.emm <- emmeans(out, ~ x*z)
  df<-data.frame(contrast(test.emm, "pairwise",  adjust = "fdr"))
  sensorymod[[i]] <-list(out,df, test.emm)
}

sensorymod2<-list()
for(i in seq(1, 24, by = 1)){
  print(paste ("this is ",i))
  df<-sensorymod[28:52][[i]][[2]]
  df$var<-names[i]
  sensorymod2[[i]] <-list(df)
  }
df_CCsen<-bind_rows(sensorymod2)
df_CCsen$pFDR<-p.adjust(df_CCsen$p.value, method = "BH")
CC_sensory<-df_CCsen[df_CCsen$pFDR <= 0.05, ] 
CC_sensory


#  ListSort_AgeAdj
# CogTotalComp_AgeAdj
# DDisc_AUC_200
warp_X<-warp_X[complete.cases(warp_X$sensory), ] 

tastesen<-ggplot(warp_X, aes(x=clustering, y= Taste_AgeAdj, color=sensory)) +
    geom_point(shape=1, alpha = 0.05) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

cogsen<-ggplot(warp_X, aes(x=clustering, y=CogTotalComp_AgeAdj, color=sensory)) +
    geom_point(shape=1, alpha = 0.05) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

ddsen<-ggplot(warp_X, aes(x=clustering, y=DDisc_AUC_200 , color=sensory)) +
    geom_point(shape=1, alpha = 0.05) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

ggarrange(tastesen, cogsen, ddsen,
          ncol = 2, nrow = 2)
```

#### Subcortical 
```{r}
warp_X <- transform(module_df, mods = interaction(group, module))
levels(warp_X$mods)
warp_X$subcortical <- NA
warp_X[warp_X$mods == "no.5", "subcortical"] <- 'aBMI5'
warp_X[warp_X$mods == "ov.6", "subcortical"] <- 'hBMI6'
warp_X[warp_X$mods == "ob.6", "subcortical"] <- 'vhBMI6'
colnames(warp_X)
warp_X$subcortical<-as.factor(warp_X$subcortical)
```

```{r}
# y is behavioral measure
# x is the group
# z is the graph measures
names<-colnames(warp_X[28:52])

subcorticalmod <- list()
for (i in seq(28, 52, by= 1)){
  print(paste("start", i))
  out<-fit_function(x=warp_X[56], y = warp_X[i], z=warp_X[19], data = warp_X)
  test.emm <- emmeans(out, ~ x*z)
  df<-data.frame(contrast(test.emm, "pairwise",  adjust = "fdr"))
  subcorticalmod[[i]] <-list(out,df, test.emm)
}

subcorticalmod2<-list()
for(i in seq(1, 24, by = 1)){
  print(paste ("this is ",i))
  df<-subcorticalmod[28:52][[i]][[2]]
  df$var<-names[i]
  subcorticalmod2[[i]] <-list(df)
  }
df_CCsub<-bind_rows(subcorticalmod2)
df_CCsub$pFDR<-p.adjust(df_CCsub$p.value, method = "BH")
CC_subcortical<-df_CCsub[df_CCsub$pFDR <= 0.05, ] 
CC_subcortical


#  ListSort_AgeAdj
# CogTotalComp_AgeAdj
# DDisc_AUC_200
warp_X<-warp_X[complete.cases(warp_X$subcortical), ] 

tastesen<-ggplot(warp_X, aes(x=clustering, y= Taste_AgeAdj, color=subcortical)) +
    geom_point(shape=1, alpha = 0.05) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

cogsen<-ggplot(warp_X, aes(x=clustering, y=CogTotalComp_AgeAdj, color=subcortical)) +
    geom_point(shape=1, alpha = 0.05) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

ddsen<-ggplot(warp_X, aes(x=clustering, y=DDisc_AUC_40K , color=subcortical)) +
    geom_point(shape=1, alpha = 0.05) +    
    geom_smooth(method=lm) + scale_color_manual(values=cbPalette)+ theme_classic()

ggarrange(tastesen, cogsen, ddsen,
          ncol = 2, nrow = 2)
```

###  Combine the tables
Keep the contrast, t-ratio, SE, var, pFDR, metric, area
Round to 2 decimal places
Add area and type 
```{r}
df_func<-function(df, m, a){
  keep<-c("metric","area","Contrast","Var","t.ratio","SE","pFDR")
  round2<-c("SE","t.ratio")
  round3<-c("pFDR")
  df$metric<-sprintf("%s", m)
  df$area<- sprintf("%s", a)
  df[round2]<-round(df[round2], 2)
  df[round3]<-round(df[round3], 3)
  
  df$contrast<-gsub('[[:digit:]]+', '', df$contrast)
  df$Contrast<-NA
  df[df$contrast == "aBMI,. - hBMI,.", "Contrast"] <- 'aBMI vs. hBMI'
  df[df$contrast == "aBMI,. - vhBMI,.", "Contrast"] <- 'aBMI vs. vhBMI'
  df[df$contrast == "hBMI,. - vhBMI,.", "Contrast"] <- 'hBMI vs. vhBMI'
  
  df[df$contrast == "aBMISmhand,. - hBMISmhand,.", "Contrast"] <- 'aBMI vs. hBMI'
  df[df$contrast == "aBMISmhand,. - vhBMISmhand,.", "Contrast"] <- 'aBMI vs. vhBMI'
  df[df$contrast == "hBMISmhand,. - vhBMISmhand,.", "Contrast"] <- 'hBMI vs. vhBMI'
  
  df[df$contrast == "aBMISmmouth,. - hBMISmmouth,.", "Contrast"] <- 'aBMI vs. hBMI'
  df[df$contrast == "aBMISmmouth,. - vhBMISmmouth,.", "Contrast"] <- 'aBMI vs. vhBMI'
  df[df$contrast == "hBMISmmouth,. - vhBMISmmouth,.", "Contrast"] <- 'hBMI vs. vhBMI'
  
  df[df$contrast == "aBMIauditory,. - hBMIauditory,.", "Contrast"] <- 'aBMI vs. hBMI'
  df[df$contrast == "aBMIauditory,. - vhBMIauditory,.", "Contrast"] <- 'aBMI vs. vhBMI'
  df[df$contrast == "hBMIauditory,. - vhBMIauditory,.", "Contrast"] <- 'hBMI vs. vhBMI'
  
  df$Var<-NA
  df[df$var == "CogCrystalComp_AgeAdj", "Var"] <- 'Crystallized Cognition Composite score'
  df[df$var == "CogEarlyComp_AgeAdj", "Var"] <- 'Early Childhood Composite score'
  df[df$var == "CogFluidComp_AgeAdj", "Var"] <- 'Fluid Cognition Composite score'
  df[df$var == "CogTotalComp_AgeAdj", "Var"] <- 'Cognitive Function Composite score'
  df[df$var == "DDisc_AUC_200", "Var"] <- 'Delay Discounting: Area Under the Curve (AUC) for Discounting of $200'
  df[df$var == "DDisc_AUC_40K", "Var"] <- 'Delay Discounting: Area Under the Curve (AUC) for Discounting of $40,000'
  df[df$var == "DDisc_SV_10yr_200", "Var"] <- 'Delay Discounting: Subjective Value for $200 at 10 years'
  df[df$var == "DDisc_SV_10yr_40K", "Var"] <- 'Delay Discounting: Subjective Value for $40,000 at 10 years'
  df[df$var == "DDisc_SV_1mo_200", "Var"] <- 'Delay Discounting: Subjective Value for $200 at 1 month'
  df[df$var == "DDisc_SV_1mo_40K", "Var"] <- 'Delay Discounting: Subjective Value for $40,000 at 1 month'
  df[df$var == "DDisc_SV_1yr_200", "Var"] <- 'Delay Discounting: Subjective Value for $200 at 1 year'
  df[df$var == "DDisc_SV_1yr_40K", "Var"] <- 'Delay Discounting: Subjective Value for $40,000 at 1 year'
  df[df$var == "DDisc_SV_3yr_200", "Var"] <- 'Delay Discounting: Subjective Value for $200 at 3 year'
  df[df$var == "DDisc_SV_3yr_40K", "Var"] <- 'Delay Discounting: Subjective Value for $40,000 at 3 year'
  df[df$var == "DDisc_SV_5yr_200", "Var"] <- 'Delay Discounting: Subjective Value for $200 at 5 year'
  df[df$var == "DDisc_SV_5yr_40K", "Var"] <- 'Delay Discounting: Subjective Value for $40,000 at 5 year'
  df[df$var == "DDisc_SV_6mo_200", "Var"] <- 'Delay Discounting: Subjective Value for $200 at 6 months'
  df[df$var == "DDisc_SV_6mo_40K", "Var"] <- 'Delay Discounting: Subjective Value for $40,000 at 6 months'
  df[df$var == "Dexterity_AgeAdj", "Var"] <- 'Dexterity'
  df[df$var == "Endurance_AgeAdj", "Var"] <- 'Endurance'
  df[df$var == "GaitSpeed_Comp", "Var"] <- 'Gait Speed'
  df[df$var == "ListSort_AgeAdj", "Var"] <- 'Working Memory (List Sorting)'
  df[df$var == "Strength_AgeAdj", "Var"] <- 'Strength'
  df[df$var == "Taste_AgeAdj", "Var"] <- 'Taste sensitivity'
  df<-df[keep]
  return(df)
}
```




```{r}
CC_sensory2<-df_func(df = CC_sensory, m = "clustering coefficient", a = "sensory module")
PC_auditory2<-df_func(df = PC_auditory, m = "participation coefficient", a ="auditory functional network")
PC_hand2<-df_func(df = PC_hand, m = "participation coefficient", a = "somatosensory hand functional network")
PC_mouth2<-df_func(df = PC_mouth, m = "participation coefficient",  a = "somatosensory mouth functional network")
CEN_visualmod2<-df_func(df = CEN_visualmod, m = "betweenness centrality", a = "visual module")
CC_subcortical2<-df_func(df = CC_subcortical, m = "clustering coefficient", a = "subcortical module")
```



```{r}
all_df<-rbind(CC_subcortical2, CC_sensory2, PC_auditory2, PC_hand2, PC_mouth2, CEN_visualmod2)
colz<-c("Metric","Area", "Contrast", "Behavioral variable", "t-ratio","SE","pFDR")
colnames(all_df)<-colz
all_df$`Behavioral variable`<-as.factor(all_df$`Behavioral variable`)
all_df
```


```{r}
write.table(all_df, "~/Google Drive/HCP/HCP_graph/1200/datasets/tmp/post_hoc.csv", sep=",", row.names = F)
```





